<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html dir=LTR><head><title>パフォーマンス チューニングについて</title>

<SCRIPT LANGUAGE="JavaScript">
<!--
	TempString = navigator.appVersion	
	if (navigator.appName == "Microsoft Internet Explorer"){	
// Check to see if browser is Microsoft
		if (TempString.indexOf ("4.") >= 0){
// Check to see if it is IE 4
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
		}
		else {
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
		}
	}
	else if (navigator.appName == "Netscape") {						
// Check to see if browser is Netscape
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
	}
	else
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
//-->
</script> 

<SCRIPT LANGUAGE="VBScript">
<!--
Sub Window_OnLoad()
   Dim frmContents
   On Error Resume Next
   If Not Parent Is Nothing Then
      Set frmContents = Parent.Contents
      If Not frmContents Is Nothing Then
            frmContents.Window.TOCSynch_Click
      End If
   End If
End Sub
//--></SCRIPT>

<META NAME="DESCRIPTION" CONTENT="Web サーバーのパフォーマンスを監視するための、Windows&nbsp;2000 のツールの使用について説明します。これには、推奨される効果的な監視方法、および特定の状況に適したツールも含まれます。">
<META HTTP-EQUIV="Content-Type" content="text/html; charset=shift_jis">

<META HTTP-EQUIV="PICS-Label" CONTENT='(PICS-1.1 "<http://www.rsac.org/ratingsv01.html>" l comment "RSACi North America Server" by "inet@microsoft.com <mailto:inet@microsoft.com>" r (n 0 s 0 v 0 l 0))'>
<META NAME="MS.LOCALE" CONTENT="JA">
<META NAME="MS-IT-LOC" Content="インターネット インフォメーション サービス">

</head>

<body bgcolor="#FFFFFF" text="#000000"><font face="ＭＳ Ｐゴシック">

<h1><a name="H1_37678224">パフォーマンス チューニングについて</a></h1>

<p>ユーザーが満足できる環境を提供するには、サーバーのパフォーマンスを最適化しておく必要があります。ハードウェアの要件は、提供するサービスによって異なります。たとえば、FTP サービスは、Web サービスほどメモリを使用しません。また、Active Server Pages (ASP) アプリケーション、Common Gateway Interface (CGI) スクリプト、データベース クエリ、およびビデオ ファイルは、静的 HTML ページに比べてプロセッサを多く使用します。トラフィックやサイトのコンテンツに変化があれば、パフォーマンスも常に変化します。パフォーマンスを効率的にチューニングするには、サーバー管理者はさまざまなツールを使用した監視計画を立てる必要があります。</p>

<p>ここでは、次の項目について説明します。</p>

<ul>
<li><a href="#TestingandTuning">周期的なテストとチューニング</a></li>
<li><a href="#PerformanceTuning">パフォーマンスの監視に使用するツール</a></li>
<li><a href="#DiskOptimization">ディスクの最適化</a></li>
</ul>

<h2><a name="TestingandTuning">周期的なテストとチューニング</a></h2>
<p>パフォーマンスのテストおよびチューニングは継続的プロセスです。効率的にテストおよびチューニングを行うには、評価方法の計画から始める必要があります。まず、パフォーマンスの現在のレベルを測定します。サーバーのパフォーマンスは時間によってかなりの差があるため、サーバーの利用状況の正確な現状を測定するには、十分な期間にわたって監視する必要があります。</p>

<p>サーバーのパフォーマンスを向上させるためには、潜在的なボトルネックがないかどうかシステムのあらゆる部分を調べます。ボトルネックは、構成が不適切なハードウェアや、IIS または Windows&nbsp;XP におけるソフトウェアの設定が原因で発生することがあります。十分な監視計画を立て、あらゆる領域のパフォーマンスを調査します。</p>

<p>サーバーのパフォーマンスの状況を把握した後、パフォーマンスを向上させるための変更を開始できます。変更する場合は、一度に 1 か所のみを変更するようにします。一度に複数の変更を実行すると、複数の変更点の影響を評価することが困難になるためです。</p>

<p>変更があるたびに、変更した結果のパフォーマンスが期待どおりか、予期しない悪影響を及ぼしていないかを確認します。あるリソースに対して行った変更が、別の領域でボトルネックを発生させる可能性があるため、変更を行った後は、すべてのリソースのパフォーマンスを確認する必要があります。変更の影響の評価を終えた後、さらに変更を行う必要があるかどうかを判断します。</p>

<h2><a name="PerformanceTuning">パフォーマンスの監視に使用するツール</a></h2>

<p>サーバーの監視は、サーバー管理の中でも特に重要な部分です。適切な監視ツールを使うことで、Web サーバーの問題を検出し、Web サイトのコンテンツの変更結果を評価し、ユーザーがアクセスしやすい Web サイトにするためのアップグレードを計画することができます。</p>

<p>最適な監視ツールおよび監視方法は、必要とする情報によって異なります。たとえば、Web サーバー全体の負荷を測定する場合は、パフォーマンス モニタを使って 1 週間のグラフを作成し、接続したコンピュータ数やファイル転送の回数などの情報を調べます。サーバーのパフォーマンスが低下していることに気付いた場合は、Windows&nbsp;XP が生成するログを表示するためのツールであるイベント ビューアで、エラーを確認します。</p>

<p>IIS が生成するログを調べ、サーバーの状況を監視することもできます。IIS のログは Windows&nbsp;XP で生成されるログよりも広範な情報を収集できます。ログ収集の詳細については、「<a href="iilogsa.htm">サイトの利用状況のログを収集する</a>」を参照してください。</p>


<p>Windows&nbsp;XP で使用できる次の監視ツールでは、逐次情報と要約情報の両方が提供されます。</p>

<ul>
<li><a href="#Sysmon">パフォーマンス モニタ</a></li>
<li><a href="#eventviewer">イベント ビューア</a></li>
<li><a href="#Taskman">タスク マネージャ</a></li>
<li><a href="#Netmon">ネットワーク モニタ</a></li>
</ul>


<p>Windows&nbsp;XP に組み込まれたツールに加え、そのほかのパフォーマンス監視ツールも使用できます。詳細については、「<a href="../asp/perf1w13.htm">パフォーマンスとセキュリティをテストする</a>」を参照してください。</p>

<h3><a name="Sysmon">パフォーマンス モニタ</a></h3>

<p>強力な MMC スナップインであるパフォーマンス モニタを使うと、サーバーの使用状況を監視し、指定した間隔ごとにサーバーのパフォーマンスを集約できます。パフォーマンス データのグラフやレポートのリアル タイムでの表示、ファイルへのデータ収集、重要なイベントの発生による警告の生成ができます。このデータを使用することで、システムにおけるボトルネックの原因を特定したり、システムおよびアプリケーションのパフォーマンスを細かく調整できます。</p>

<p>パフォーマンス モニタには、次の 3 通りの起動方法があります。</p>

<ul>
<li>[スタート] メニューの [プログラム]、[管理ツール] をクリックし、次に [パフォーマンス] をクリックします。</li>
<li>[スタート] メニューの [ファイル名を指定して実行] をクリックし、[名前] ボックスで「perfmon」と入力して、<b>Enter</b> キーを押します。 
<li>コマンド プロンプトで、「perfmon」と入力します。</li>
</ul>

<p>パフォーマンス モニタは、特定の &quot;パフォーマンス オブジェクト&quot; の活動を監視する &quot;パフォーマンス カウンタ&quot; の出力を調べます。&quot;パフォーマンス オブジェクト&quot; とは、サーバーのリソースを制御する特定のサービスまたはメカニズムのことです。たとえば、パフォーマンス モニタのプラス記号 (+) をクリックした場合、Web Service というパフォーマンス オブジェクト、および 1 秒あたりの受信バイト数や接続試行回数などを監視するカウンタの一覧が表示されます。このウィンドウからは、パフォーマンス モニタの画面に対してカウンタの追加や削除をしたり、特定の方法でカウンタを記録するように設定することができます。多数のカウンタを同時に実行すると、パフォーマンスがわずかに低下することがあります。実行するカウンタを限定することが必要です。&nbsp;</p>

<p>Windows&nbsp;XP には、ディスクの使用状況や TCP の動作状態を監視するものも含め、さまざまなカウンタがあります。IIS では、Web サービス カウンタ、FTP サービス カウンタ、Active Server Pages アプリケーション カウンタ、IIS グローバル カウンタなどの専用カウンタがインストールされます。Web サービス カウンタ、FTP サービス カウンタ、および Active Server Pages オブジェクト カウンタは、スクリプトの接続状態を監視するためのものです。一方、IIS グローバル カウンタは、すべての IIS サービスについて帯域幅の使用状況やキャッシュ処理状況を監視するためのものです。通常、カウンタでは量、数、期間などの観点から計測します。表示するカウンタを選択する際は、この点に留意してください。</p>

<p>パフォーマンス モニタは、サーバーやサイトの負荷に関する短期および長期の両方の情報を提供するように設計されています。次の表は、サーバーの監視に役立つパフォーマンス モニタのカウンタの一覧です。各カウンタの理想的な平均値も示します。パフォーマンス モニタのグラフは、0 〜 100 の間で目盛が作成されます。小さな値を記録する個々のカウンタに対しては、目盛を変更する必要もあります。&nbsp;</p>

<table border=1 width=95% cellpadding=1 cellspacing=1>
<caption align=top></caption>
<tr><th>オブジェクト: カウンタ</th><th>理想値</th></tr>
<tr><td>Memory\Pages/sec</td><td>0 〜 20 (80 を超える場合は問題があることを示します)。</td></tr>
<tr><td>Memory\Available Bytes</td><td>20 MB 以上。</td></tr>
<tr><td>Memory\Committed Bytes</td><td>物理メモリ容量の約 75% 以下。</td></tr>
<tr><td>Memory\Pool Nonpaged Bytes</td><td>一定 (緩やかな上昇は、メモリ リークの可能性を示しています)。</td></tr>
<tr><td>Processor\% Processor Time</td><td>75% 未満。</td></tr>
<tr><td>Processor\Interrupts/sec</td><td>プロセッサによって異なります。486/66 プロセッサの場合は、1,000 以下、Pentium 90 MHz の場合は 3,500、Pentium 200 MHz の場合は 7,000 以上。この数値はできるだけ小さい方が理想的です。 </td></tr>
<tr><td>Processor\System Processor Queue Length</td><td>2 以下。</td></tr>
<tr><td>(Logical or Physical) Disk \ % Disk Time</td><td>できる限り小さい値。</td></tr>
<tr><td>(Logical or Physical) Disk \ Avg.Disk Queue Length</td><td>2 未満。</td></tr>
<tr><td>(Logical or Physical) Disk \ Avg Disk Bytes/Transfer</td><td>できる限り大きい値。</td></tr>
<tr><td>Internet Information Services Global\File Cache Hits %</td><td>できる限り大きい値。ただし、この値はサイトのコンテンツに依存する。</td></tr>
<tr><td>Web Service\Bytes Total/sec</td><td>できる限り大きい値。</td></tr>
<tr><td>Active Server Pages\Request Wait Time</td><td>ASP\Request Execution Time</td></tr>
<tr><td>Active Server Pages\Requests Queued</td><td>0。</td></tr>
<tr><td>Active Server Pages\Transactions/sec</td><td>できる限り大きい値。</td></tr></table>

<p>パフォーマンス モニタの使用方法の詳細については、Windows&nbsp;XP のマニュアルを参照してください。IIS が提供するカウンタの一覧については、「<a href="iicntpm.htm">カウンタ リファレンス</a>」を参照してください。</p>

<h3><a name="eventviewer">イベント ビューア</a></h3>

<p>Windows&nbsp;XP には、サービスに関するエラーや起動成功などのイベントを記録するイベント ログ収集サービスが用意されています。記録されたイベント ログは、イベント ビューアで表示します。イベント ビューアを使用して、システム、セキュリティ、およびアプリケーションのイベント ログを監視できます。ログの情報を調べることで、パフォーマンスにかかわる特定の問題をもたらしたイベントのシーケンスと種類について、詳しい情報を得ることができます。イベント ビューアの使用方法の詳細については、Windows&nbsp;XP のマニュアルを参照してください。</p>

<h3><a name="Taskman">タスク マネージャ</a></h3>
<p>タスク マネージャを使用して、実行中のタスクおよびスレッドを表示します。また、プロセスに割り当てられた優先順位を変更する際にも使用できます。ただし、プロセスが完了すると、新しく割り当てた優先順位は無効になります。CPU やメモリの使用状況をリアル タイムで表示できますが、この情報は保存されません。タスク マネージャの使用方法の詳細については、Windows&nbsp;XP のマニュアルを参照してください。</p>

<h3><a name="Netmon">ネットワーク モニタ</a></h3>

<p>ネットワーク モニタは、コンピュータ間でやり取りされるトラフィックの情報をキャプチャし、送受信されるフレームについての詳細な情報を提供します。このツールを使うと、ネットワーク トラフィックの複雑なパターンを分析できます。ネットワーク モニタを使用することで、サーバーへの HTTP 要求や FTP 要求に含まれているヘッダー情報を表示できます。通常は、データベースのクエリのような機能を持ち、伝送されるフレームのサブセットを選択する、キャプチャ フィルタを設計する必要があります。また、実行可能ファイルの起動などのアクションを開始することによって、ネットワーク上で発生するイベントに応答する &quot;キャプチャ トリガ&quot; を使用することもできます。Windows XP の一部のバージョンには、ネットワーク モニタの簡易版が付属しています。Systems Management Server には、ネットワーク モニタの完全版が付属しています。ネットワーク モニタの詳細については、Windows&nbsp;XP のマニュアルおよび『Windows リソース キット』を参照してください。</p>

<h2><a name="DiskOptimization">ディスクの最適化</a></h2>

<p>ハード ディスクのボトルネックは、ランダムにアクセスされる大きなファイル セットのあるサイトで最も頻繁に見られます。IIS がハード ディスクにアクセスする頻度は、RAM の容量、および要求されたファイルの数とサイズに直接関係します。大量のファイルや大きいサイズのファイルが要求された場合に、RAM の容量が小さいと、IIS はファイルのコピーを RAM に保管してアクセスを高速にすることができません。この場合、IIS はハード ディスクからファイルを取得しなければなりません。IIS が要求されたファイルの取得に要する時間は、ハード ディスクのアクセス速度と容量によって異なります。</p>

<p>ディスク ドライブを監視するには、パフォーマンス モニタを使用して CPU の使用率、ネットワーク カードの飽和状態、および Physical Disk オブジェクトの % Disk Time カウンタをログに記録します。% Disk Time カウンタの値が大きく、CPU およびネットワーク カードの使用率が小さい場合は、ディスク ドライブがボトルネックになっています。Physical Disk の % Disk Time カウンタの詳細については、Windows&nbsp;XP のマニュアルを参照してください。</p>

<p>ディスク アクセスを向上させるには、RAID を使用して、ハードディスクをストライプ セットに構成します。サーバーを主にデータベースとして使用している場合は、メモリ、CPU、およびディスク リソースに関してデータベースと IIS が競合することになるため、最新バージョンの適切な Windows のサーバーを別のコンピュータで実行することを検討してください。Windows XP をデータベース サーバーと同じコンピュータで実行するのであれば、アクセス遅延を最小にとどめるためのギガバイト単位の RAM か、または RAM キャッシュが大きいドライブ コントローラが必要です。あるドライブが機能しなくなった場合に、バックアップ コピーから復元しなくてもよいように、冗長性も必要です。多くの新しいコントローラでは &quot;ホット スワッピング&quot; を使用でき、これによってドライブで障害が発生した場合に、サーバーを停止せずに別のドライブに置き換えることができます。このような環境であっても、バックアップをとること、同じデータを別のドライブ上でも管理することなどをお勧めします。</p>


<hr class="iis" size="1"><p align="center"><em><a href="/iishelp/common/colegal.htm">&copy; 1997-2001 Microsoft Corporation.All rights reserved.</a></em></p>

</font>
</body>
</html>
