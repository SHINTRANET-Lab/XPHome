<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR=LTR>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=shift_jis">
<TITLE>ClientCertificate</TITLE>
<SCRIPT LANGUAGE="JavaScript">
<!--
	TempString = navigator.appVersion
	if (navigator.appName == "Microsoft Internet Explorer"){	
// Check to see if browser is Microsoft
		if (TempString.indexOf ("4.") >= 0){
// Check to see if it is IE 4
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
		}
		else {
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
		}
	}
	else if (navigator.appName == "Netscape") {						
// Check to see if browser is Netscape
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
	}
	else
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
//-->
</script> <SCRIPT LANGUAGE="VBScript">
<!--
Sub Window_OnLoad()
   Dim frmContents
   On Error Resume Next
   If Not Parent Is Nothing Then
      Set frmContents = Parent.Contents
      If Not frmContents Is Nothing Then
            frmContents.Window.TOCSynch_Click
      End If
   End If
End Sub
//--></SCRIPT><META NAME="DESCRIPTION" CONTENT="インターネット インフォメーション サービス リファレンス情報">
<META HTTP-EQUIV="PICS-Label" CONTENT='(PICS-1.1 "<http://www.rsac.org/ratingsv01.html>" l comment "RSACi North America Server" by "inet@microsoft.com <mailto:inet@microsoft.com>" r (n 0 s 0 v 0 l 0))'>
<META NAME="MS.LOCALE" CONTENT="JA">
<META NAME="MS-IT-LOC" Content="インターネット インフォメーション サービス"> 
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<H4><A NAME="_clientcertificate"></A><SUP></SUP>ClientCertificate</H4>

<P>ClientCertificate コレクションは、クライアント ブラウザが Web サーバーに送信するセキュリティ証明書のキーおよび値に関するフィールド群を保持しています。このフィールド群は、公開キー証明書の X.509 Version 3 規格で定められています。X.509 は公的な規格ではないため、各証明機関が発行する証明書の間には差異が認められます。<a href="http://www.microsoft.com/isapi/redir.dll?prd=external&sbp=W3org&pver=1.0&ar=specs" target=_blank>World Wide Web Consortium Web サイト</a> の「X509 Certificate」という記事を参照してください。</P>

<P>ClientCertificate コレクションのフィールド群を読み込むには、Web サーバーとクライアント ブラウザの両方で SSL3.0/PCT1.0 プロトコルをサポートしている必要があります。Web サイトでは SSL を有効にして、クライアント証明書を要求します。SSL が有効になると、Web サイトの URL は &quot;http://&quot; ではなく、&quot;https://&quot; で始まります。クライアント ブラウザでは、証明書の送信を有効にしておきます。証明書がまったく送信されない場合、ClientCertificate コレクションは EMPTY を返します。</P>

<P>Web サーバーを構成してクライアント証明書を要求する方法については、「<A HREF="../core/iisslsc.htm">サーバーに SSL をセットアップする</A>」を参照してください。 </P>

<P>ClientCertificate コレクションの各フィールドの値を読み込むには、キー名と省略可能なサブフィールド名を渡します。</P>

<H6>構文</H6>

<P>Request.<B>ClientCertificate</B>( <I>Key</I>[<I>SubField</I>] )</P>

<P><B>&nbsp;</B></P>

<H6>パラメータ</H6>

<DL>
<DT><I>Key</I></DT>

<DD>取得する証明書フィールドの名前を指定します。クライアント証明書を構成しているフィールドは、次のとおりです。

<TABLE border=0 cellpadding=5 cols=2 frame=box rules=all>

<TR VALIGN="top">
<TD class=blue width=22%><B>値</B></TD>
<TD class=blue width=78%><B>意味</B></TD>
</TR>

<TR VALIGN="top">
<TD width=22%>Certificate</TD>
<TD width=78%>ASN.1 形式による、証明書のコンテンツ全体のバイナリ ストリームを含む文字列です。このフィールドは、以下で取り上げていない特別な SubField が存在するかどうかを検出するために使用できます。</TD>
</TR>

<TR VALIGN="top">
<TD width=22%>Flags</TD>
<TD width=78%>クライアント証明書の補足情報となる一連のフラグです。Flags が 1 に設定されている場合、クライアント証明書は存在します。Flags が 2 に設定されている場合、このチェインの最後の証明書は未知の発行者からのものです。</TD>
</TR>

<TR VALIGN="top">
<TD width=22%>Issuer</TD>
<TD width=78%>サブフィールド値のリストからなる文字列です。サブフィールドには証明書の発行者に関する情報が含まれています。この値を <i>SubField</i> なしで指定した場合、ClientCertificate コレクションはカンマで区切られたサブフィールドのリストを返します。たとえば、&quot;C=US, O=Verisign, ...&quot; などです。</TD>
</TR>

<TR VALIGN="top">
<TD width=22%>SerialNumber</TD>
<TD width=78%>証明書のシリアル番号からなる文字列です。16 進バイト値をハイフン (-) で区切って ASCII 文字で表現したものです。たとえば、&quot;04-67-F3-02&quot; などとなります。</TD>
</TR>

<TR VALIGN="top">
<TD width=22%>Subject</TD>
<TD width=78%>サブフィールド値のリストからなる文字列です。サブフィールドには証明書のサブジェクトに関する情報が含まれています。この値を <i>SubField</i> なしで指定した場合、ClientCertificate コレクションはカンマで区切られたサブフィールドのリストを返します。たとえば、&quot;C=US, O=Msft, ...&quot; などとなります。</TD>
</TR>

<TR VALIGN="top">
<TD width=22%>ValidFrom</TD>
<TD width=78%>証明書がいつから有効かを表す日付です。この日付は VBScript の形式に従い、各国対応設定によって変化します。たとえば、米国では 9/26/96 11:59:59 PM という形式になります。年の値は 4 桁の数値で表示されます。</TD>
</TR>

<TR VALIGN="top">
<TD width=22%>ValidUntil</TD>
<TD width=78%>証明書の有効期限がいつ切れるかを表す日付です。年の値は 4 桁の数値で表示されます。</TD>
</TR>
</TABLE><BR>

<BR>
</DD>

<DT><I>SubField</I></DT>

<DD>&quot;Subject&quot; または &quot;Issuer&quot; のどちらかのキーの中の個々のフィールドを取得するために使用する、省略可能なパラメータです。このパラメータはサフィックスとして <i>Key</i> パラメータの後に追加します。たとえば、&quot;IssuerO&quot;、&quot;SubjectCN&quot;、などとなります。次の表は、一般的な <i>SubField</i> の値のいくつかを示しています。

<TABLE border=0 cellpadding=5 cols=2 frame=box rules=all>

<TR VALIGN="top">
<TD class=blue width=18%><B>値</B></TD>
<TD class=blue width=82%><B>意味</B></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>C</TD>
<TD width=82%>発行国名/地域名を指定します。 </TD>
</TR>

<TR VALIGN="top">
<TD width=18%>CN</TD>
<TD width=82%>ユーザーの一般名を指定します。(このサブフィールドは必ず &quot;Subject&quot; キーと共に使用されます。)</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>GN</TD>
<TD width=82%>名前を指定します。</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>I</TD>
<TD width=82%>イニシャルを指定します。</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>L</TD>
<TD width=82%>地域名を指定します。</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>O</TD>
<TD width=82%>企業名または組織名を指定します。 </TD>
</TR>

<TR VALIGN="top">
<TD width=18%>OU</TD>
<TD width=82%>部署名を示します。</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>S</TD>
<TD width=82%>州名または地方名を指定します。</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>T</TD>
<TD width=82%>役職名を指定します。</TD>
</TR>
</TABLE><BR>



<P>この表で列挙したもの以外の SubField 値については、それらの ASN.1 オブジェクト識別子 (OID) によって識別できます。OID の形式は、ピリオド (.) で区切られた数値のリストです。証明書における OID のリストは、発行元の証明機関から入手できます。
</DD>
</DL>

<H6>例</H6>

<P>ループを使用すると ClientCertificate コレクションのすべてのキーを解析できます。この例を次に示します。</P>

<PRE><CODE>&lt;%
  For Each strKey in Request.ClientCertificate
    Response.Write strkey &amp; " = " &amp; Request.ClientCertificate(strkey) &amp; "&lt;BR&gt;"
  Next
%&gt;
 </CODE></PRE>

<P>次の例は、クライアント証明書を発行した企業の一般名を取得します。</P>

<PRE><CODE>&lt;%= Request.ClientCertificate("IssuerCN") %&gt;
 </CODE></PRE>

<P>次の例は、クライアント証明書の有効期限を表示します。</P>

<PRE><CODE>This certification will expire on 
&lt;%= Request.ClientCertificate("ValidUntil") %&gt;
 
The following example uses the Flags key to test whether the issuer of the certificate is known.
&lt;%
  Const ceCertPresent = 1
  Const ceUnrecognizedIssuer = 2
  If Request.ClientCertificate("Flags") = ceUnrecognizedIssuer Then
    Response.Write "Unrecognized issuer"
  End If
%&gt;
 </CODE></PRE>

<P>次の例は、クライアント証明書のすべてのフィールドを表示します。</P>

<PRE><CODE>Issuer: &lt;%=Request.ClientCertificate("Issuer")%&gt;&lt;br&gt;
Subject: &lt;%=Request.ClientCertificate("Subject")%&gt;&lt;br&gt;

&lt;% cer=Request.ClientCertificate("Certificate") %&gt;
Certificate Raw Data: &lt;%=cer%&gt;&lt;br&gt;
Certificate length: &lt;%=len(cer)%&gt;&lt;br&gt;
Certificate Hex Data:
&lt;% For x=1 To 100 %&gt;
  &lt;%=hex(asc(mid(cer,x,1)))%&gt;&amp;nbsp;
&lt;% Next %&gt;
</CODE></PRE>

<H6>対象</H6>

<P>Request オブジェクト </P>

<H6>関連項目</H6>

<P><A HREF="/iishelp/iis/htm/asp/vbob0z3o.htm"><B>Cookies</B></A>、<A HREF="/iishelp/iis/htm/asp/vbob4fl9.htm"><B>Form</B></A>、<A HREF="/iishelp/iis/htm/asp/vbob53hj.htm"><B>QueryString</B></A>、<A HREF="/iishelp/iis/htm/asp/vbob5vsj.htm"><B>ServerVariables</B></A>、<a href="http://www.microsoft.com/isapi/redir.dll?prd=msdn&sbp=workshop&pver=6.0&ar=web&sba=security" target=_blank><b><span class=le>Security and Cryptography</span></b></a></P>
<hr class="iis" size="1">
<p align="center"><em><a href="../../../common/colegal.htm">&copy; 1997-2001 Microsoft Corporation.All rights reserved.</a></em></p>
</BODY>
</HTML>
