<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR=LTR>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=shift_jis">
<TITLE>パフォーマンスの高い ISAPI アプリケーションを設計する</TITLE>
<SCRIPT LANGUAGE="JavaScript">
<!--
	TempString = navigator.appVersion
	if (navigator.appName == "Microsoft Internet Explorer"){	
// Check to see if browser is Microsoft
		if (TempString.indexOf ("4.") >= 0){
// Check to see if it is IE 4
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
		}
		else {
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
		}
	}
	else if (navigator.appName == "Netscape") {						
// Check to see if browser is Netscape
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
	}
	else
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
//-->
</script> <SCRIPT LANGUAGE="VBScript">
<!--
Sub Window_OnLoad()
   Dim frmContents
   On Error Resume Next
   If Not Parent Is Nothing Then
      Set frmContents = Parent.Contents
      If Not frmContents Is Nothing Then
            frmContents.Window.TOCSynch_Click
      End If
   End If
End Sub
//--></SCRIPT><META NAME="DESCRIPTION" CONTENT="インターネット インフォメーション サービス リファレンス情報">
<META HTTP-EQUIV="PICS-Label" CONTENT='(PICS-1.1 "<http://www.rsac.org/ratingsv01.html>" l comment "RSACi North America Server" by "inet@microsoft.com <mailto:inet@microsoft.com>" r (n 0 s 0 v 0 l 0))'>
<META NAME="MS.LOCALE" CONTENT="JA">
<META NAME="MS-IT-LOC" Content="インターネット インフォメーション サービス"> 
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<H1><A NAME="_k2_designing_high_performance_isapi_applications"></A><SUP></SUP>パフォーマンスの高い ISAPI アプリケーションを設計する</H1>

<P>ISAPI は、最も高いパフォーマンスを備えた、Web アプリケーション用のインターフェイスです。ISAPI 拡張または ISAPI フィルタを作成する場合、その性能は ASP ページのスクリプトまたは同様のタスクを実行するコンポーネントよりも優れている場合があります。ISAPI インターフェイスは本来、速度の面で優れていますが、パフォーマンスと拡張性についての考慮が必要です。実際、ISAPI では、ASP と COM が提供するアプリケーション サポート サービスの多くを利用できません。たとえば、ISAPI アプリケーションでセッション状態を維持する場合は、セッション状態機能の多くを実装する必要があります。</P>

<P>次に、ISAPI 拡張の拡張性とパフォーマンスを向上させるためのいくつかの方法を示します。

<UL type=disc>
	<LI><B>ISAPI フィルタの使用を避ける  </B><B></B>アプリケーション アーキテクチャに ISAPI フィルタの追加が必要である場合を除き、フィルタはなるべく使用しないようにします。生の入出力データの処理を実行するフィルタの使用は、特に避けるべきです。フィルタがどうしても必要な場合は、フィルタ イベント通知コードを使用して主要コード パスを最適化するように、十分注意してください。</li>

	<LI><B>独自のワーカー スレッド プールを作成する  </B>これによって、主要入出力スレッドが解放され、ほかのタスクを実行できるようになります。このオプションは、ISAPI 拡張だけに使用できます。 </li>

	<LI><B>非同期動作および入出力完了ポートを使用する  </B>IIS は、入出力完了ポートを使用した非同期の読み取りと書き込みをサポートします。これは、Windows NT 4.0、および Windows 2000 以降で使用できます。実行される入出力動作の種類により、非同期動作は使用できる CPU 時間をうまく使用し、通常、ワーカー スレッド プールを使用して実装されたときは特に効果的に動作します。 </li>

	<LI><B>Win32 TransmitFile 関数を使用する  </B>HTML またはイメージ ファイルを送信するときは、ISAPI 拡張に Win32 TransmitFile 関数を使用します。この関数は、HSE_REQ_TRANSMIT_FILE ServerSupportFunction により公開されます。 </li>

	<LI><B>キープアライブ ヘッダーを使用する  </B>ほとんどの場合、固定 HTTP 接続を維持すると、非固定接続を使用した場合より優れたパフォーマンスが得られます。 </li>

	<LI><B>スレッドの同期化の必要性を最少限にする  </B>これは、要求コンテキストでセッション状態情報を維持することにより実施します。スレッド同期化が要求された場合、重要なセクションが短くなっていることを確認します。</li>

	<LI><B>ヒープに代わる方法を考える  </B>ISAPI アプリケーションでヒープを頻繁に使用する場合は、ヒープに代わる方法をとります。Windows<sup>&reg;</sup> ヒープを頻繁に使用すると、リソースの競合が発生する可能性があります。メモリ割り当ての代替方法をいくつかお勧めします。これには、次の方法が挙げられます。
<UL type=disc>
	<LI><B>ヒープの分割  </B>これは、既定のプロセス ヒープのほかに、カスタム ヒープを複数 (各スレッドに 1 つずつ) 作成することにより実施できます。各カスタム ヒープを、個別の非グローバルなロックで制御して、ロックの競合を減少させます。</li>

	<LI><B>キャッシュされた割り当て  </B>これには、オブジェクト ユーザーとヒープの間の中間層で動作するカスタム割り当てを実行します。Win32 ヒープの呼び出しはあまり頻繁には発生せず、大きなメモリ ブロックについてのみです。これらのブロックは下位に区分化され、カスタム アロケータにより管理されます。</li>

	<LI><B>スタック割り当て  </B>これは、C ランタイム関数である _alloca を使用して、オブジェクト用のメモリをヒープではなくスタック上に割り当てます。このメソッドは、スタック上で使用できるスペースが限られているために、比較的小さなオブジェクトにだけ適しています。さらに、新しく割り当てられたオブジェクトは、現在の関数、またはその関数が呼び出した関数の中でのみ使用されます。現在の関数がメインの呼び出し側プログラムに戻った後は、スタックに割り当てられた記憶域は消失します。</li>

	<LI><B>オブジェクトのカプセル化  </B>バッファをクラスのメンバ データ構造として組み込みます。このバッファは、Win32 ヒープへのアクセスが必要なタスクに使用します。</li>
</UL>
</li>

	<LI><B>ISAPI 内でのグローバル ロックの使用を避ける  </B>グローバル ロックは、通常、拡張性に悪影響を与えます。</li>
</UL>

<P>	ISAPI 拡張および ISAPI フィルタの詳細については、「MSDN Online Library」の「<a href="http://www.microsoft.com/japan/developer/library/default.asp?URL=/japan/developer/library/vccore/_core_steps_to_create_a_typical_isapi_extension.htm" target=_blank>代表的な ISAPI 拡張機能の作成手順</a>」セクション、または「<a href="http://go.microsoft.com/fwlink/?LinkId=1699" target=_blank>ISAPI Reference</a>」セクション (英語) を参照してください。</P>
<hr class="iis" size="1">
<p align="center"><em><a href="../../../common/colegal.htm">&copy; 1997-2001 Microsoft Corporation.All rights reserved.</a></em></p>
</BODY>
</HTML>
